FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive
ARG BAZEL_VERSION=8.3

# Install dependencies and Bazel
RUN DEBIAN_FRONTEND=noninteractive \
    apt update && \
    apt install -y --no-install-recommends \
      build-essential \
      curl \
      python3 \
      python3-pip \
      wget \
      git \
      rsync \
      tree \
      unzip && \
    # Install bazel
    BAZEL_ARCH=$([ $(uname -m) = "aarch64" ] && echo "arm64" || echo "amd64") && \
    curl \
      -L "https://github.com/bazelbuild/bazelisk/releases/download/v1.27.0/bazelisk-linux-${BAZEL_ARCH}" \
      -o /usr/local/bin/bazel && \
    chmod +x /usr/local/bin/bazel && \
    # Install uv
    curl -LsSf https://astral.sh/uv/install.sh | sh

# Install bazel
RUN bazel --version

WORKDIR /app
