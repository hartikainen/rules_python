uv pip compile \
  --no-strip-extras \
  --generate-hashes \
  --emit-index-url \
  ./requirements.in \
  -o ./requirements.txt

echo "creating uv venv"
uv venv --python=3.12 --clear
source ./.venv/bin/activate
uv pip install -r ./requirements.txt

echo "building bazel venv"
bazel build //:test

# echo "creating 'raw' bazel venv with dereferenced symlinks"
# mv ./bazel-bin/test.runfiles/_main/_test.venv/ ./bazel-bin/test.runfiles/_main/_test.venv.bu/
# rsync \
#   -aL \
#   --delete \
#   ./bazel-bin/test.runfiles/_main/_test.venv.bu/ \
#   ./bazel-bin/test.runfiles/_main/_test.venv/

# root@58101d184a03:/app/examples/site-packages# source ./.venv/bin/activate
# (site-packages) root@58101d184a03:/app/examples/site-packages# python ./test.py
# Hello, nvidia=<module 'nvidia' (namespace) from ['/app/examples/site-packages/.venv/lib/python3.12/site-packages/nvidia']>!
# Hello, jax=<module 'jax' from '/app/examples/site-packages/.venv/lib/python3.12/site-packages/jax/__init__.py'>!
# jax.devices('gpu')=[CudaDevice(id=0)]
